# Vesper Configuration Template
# Copy this file to .env and fill in secure values

# Redis (Working Memory Cache)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=change-me-to-secure-password-32-chars

# Qdrant (Vector Database)
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=change-me-to-secure-api-key-32-chars

# PostgreSQL (Metadata Store)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=memory
POSTGRES_USER=postgres
POSTGRES_PASSWORD=change-me-to-secure-password-32-chars

# SQLite (Knowledge Graph)
SQLITE_DB=./data/memory.db

# Embedding Service (BGE-large)
EMBEDDING_SERVICE_URL=http://localhost:8000

# Application
NODE_ENV=development
LOG_LEVEL=info

# Rate Limiting Configuration
# Tier: standard, premium, or unlimited
RATE_LIMIT_DEFAULT_TIER=standard

# Fail-closed behavior (recommended for security)
# When true, requests are allowed if Redis is unavailable
# When false (default), requests are denied if Redis is unavailable
RATE_LIMIT_FAIL_OPEN=false

# Emergency rate limit when Redis is down (per operation, per minute)
RATE_LIMIT_EMERGENCY=10

# Custom rate limits (per minute) - override tier defaults
# RATE_LIMIT_STORE_MEMORY=100
# RATE_LIMIT_RETRIEVE_MEMORY=300
# RATE_LIMIT_LIST_RECENT=60
# RATE_LIMIT_GET_STATS=30

# Rate Limit Tiers Reference:
# | Tier      | store_memory | retrieve_memory | list_recent | get_stats |
# |-----------|--------------|-----------------|-------------|-----------|
# | standard  | 100/min      | 300/min         | 60/min      | 30/min    |
# | premium   | 500/min      | 1000/min        | 200/min     | 100/min   |
# | unlimited | no limit     | no limit        | no limit    | no limit  |

# =============================================================================
# MCP Authentication (SEC-CRIT-001)
# =============================================================================

# Enable/disable authentication (default: false for development)
# Set to 'true' in production to require API keys
AUTH_ENABLED=false

# Default API key expiration in days (default: 90, max: 365)
API_KEY_EXPIRATION_DAYS=90

# For simple single-key setup (alternative to PostgreSQL):
# Generate with: npx tsx scripts/generate-api-key.ts
# MCP_API_KEY=mem_v1_your-generated-key-here
# MCP_API_KEY_HASH=$2b$12$... (bcrypt hash of the key)
# MCP_API_KEY_USER_ID=your-user-id
# MCP_API_KEY_TIER=standard
# MCP_API_KEY_SCOPES=store_memory,retrieve_memory,list_recent,get_stats

# For PostgreSQL-based key management:
# Run the schema: psql -f config/postgres-auth-schema.sql
# Keys will be stored in the api_keys table

# =============================================================================
# Security Notes
# =============================================================================

# The install.sh script will automatically generate secure random passwords.
# If creating .env manually, use: openssl rand -base64 32

# API Key Format: mem_v1_<40-character-random-string>
# Example: mem_v1_k8f7g3h2j9k0l1m2n3o4p5q6r7s8t9u0v1w2x3y4z5

# Rate Limit Tiers:
# | Tier       | store_memory | retrieve_memory | list_recent | get_stats |
# |------------|--------------|-----------------|-------------|-----------|
# | standard   | 100/min      | 300/min         | 60/min      | 30/min    |
# | premium    | 500/min      | 1000/min        | 200/min     | 100/min   |
# | unlimited  | no limit     | no limit        | no limit    | no limit  |

# =============================================================================
# Quick Start (Personal Use)
# =============================================================================
# For personal/development use, the defaults above work out of the box!
# Just run: docker-compose up -d
#
# AUTH_ENABLED=false means no authentication required (easy setup)
# RATE_LIMIT_FAIL_OPEN=false means requests denied if Redis unavailable (safe default)
#
# For production deployment with security, see README.md

# =============================================================================
# Docker Port Mapping (Optional)
# =============================================================================
# Override default ports if you have conflicts with existing services
# Uncomment and modify if needed:
# REDIS_PORT=6380
# QDRANT_PORT=6334
# EMBEDDING_PORT=8001
